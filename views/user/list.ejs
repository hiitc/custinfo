<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <script type="text/javascript">
    
        // var frm = document.getElementById("frm");


        // frm.submit();

        var rowclick = function(e) {
            console.log(e.children)
            console.log(e.children[3].defaultValue)
            console.log(e.children[4].defaultValue)

            sendAjax('/users/detail', {custCode : e.children[3].defaultValue, seq : e.children[4].defaultValue})
            
        }
    </script>
    <link rel="shortcut icon" href="http://angangenc.co.kr/kr/favicon.png" />

    <style type="text/css">
        body {
            background: #fff;
        }

        .bluetop {
            border-collapse: collapse;
            border-top: 3px solid rgba(170, 25, 56, 0.856);
        }

        .bluetop th {
            color: rgba(170, 25, 56, 0.856);
            background: #fcf1f5;
        }

        .bluetop th,
        .bluetop td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        .bluetop th:first-child,
        .bluetop td:first-child {
            border-left: 0;
        }

        .bluetop th:last-child,
        .bluetop td:last-child {
            border-right: 0;
        }

        .container {
            width: 100%;
            position: relative;
            height: 130px;
            place-items: center;
            text-align: center;
            display: grid;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            position: relative;
            height: 130px;
            place-items: center;
            text-align: center;
            display: grid;
            min-height: 100vh;
        }
    </style>
    
</head>
<body>
    <h1><%= title %></h1>

    <script>
        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

		//send함수 'http://localhost:3000/ajax'주소에 inputdata를 보냅니다.
        function sendAjax(url, data) {

            data = JSON.stringify(data);
            
    		//data에 inputdata를 json형식으로 넣고 이를 xmlhttprequest를 통해 post방식으로 보냅니다.
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-type', "application/json");
            xhr.send(data);
			
            //서버에서 결과가 도착하면 그것을 result div에 입력합니다.
            xhr.addEventListener('load', function () {
                var result = JSON.parse(xhr.responseText);
                var html = '';
                
                if (document.getElementById("detailTable")) {
                    console.log('잇다 지워라')
                    document.getElementById("detailTable").remove();
                } else{
                    console.log('없음')
                }
                
                var table = document.createElement('TABLE');
                    table.id = "detailTable"
                    table.className = "bluetop"
                    table.style.width = "1000px"



                var td1 = document.createElement("TH");
                    td1.innerHTML = "구분";
                    td1.style.width = "100px"
                    td1.style.padding = "3px";
                    td1.style.textAlign = "center";

                var td2 = document.createElement("TH");
                    td2.innerHTML = "약정일";
                    td2.style.padding = "3px";
                    td2.style.textAlign = "center";

                var td3 = document.createElement("TH");
                    td3.innerHTML = "약정금액";
                    td3.style.width = "90px"
                    td3.style.textAlign = "center";

                var td4 = document.createElement("TH");
                    td4.innerHTML = "납입횟수";
                    td4.style.padding = "3px";
                    td4.style.textAlign = "center";

                var td5 = document.createElement("TH");
                    td5.innerHTML = "입금일";
                    td5.style.padding = "3px";
                    td5.style.textAlign = "center";

                var td6 = document.createElement("TH");
                    td6.innerHTML = "입금금액";
                    td6.style.width = "90px"
                    td6.style.textAlign = "center";

                var td7 = document.createElement("TH");
                    td7.innerHTML = "연체일수";
                    td7.style.padding = "3px";
                    td7.style.textAlign = "center";

                var td8 = document.createElement("TH");
                    td8.innerHTML = "연체금액";
                    td8.style.padding = "3px";
                    td8.style.textAlign = "center";

                var td9 = document.createElement("TH");
                    td9.innerHTML = "할인일수";
                    td9.style.padding = "3px";
                    td9.style.textAlign = "center";

                var td10 = document.createElement("TH");
                    td10.innerHTML = "할인금액";
                    td10.style.padding = "3px";
                    td10.style.textAlign = "center";

                var td11 = document.createElement("TH");
                    td11.innerHTML = "실납입액";
                    td11.style.width = "90px"
                    td11.style.textAlign = "center";

                var tr = document.createElement("TR");
                    tr.appendChild(td1)
                    tr.appendChild(td2)
                    tr.appendChild(td3)
                    tr.appendChild(td4)
                    tr.appendChild(td5)
                    tr.appendChild(td6)
                    tr.appendChild(td7)
                    tr.appendChild(td8)
                    tr.appendChild(td9)
                    tr.appendChild(td10)
                    tr.appendChild(td11)

                table.appendChild(tr)

                for (key in result){
                    var td1 = document.createElement("TD");
                        td1.innerHTML = result[key]["agree_name"];
                        td1.style.padding = "3px";
                        td1.style.textAlign = "center";

                    var td2 = document.createElement("TD");
                        td2.innerHTML = result[key]["agreedate"].substr(0,10);
                        td2.style.padding = "3px";
                        td2.style.textAlign = "center";

                    var td3 = document.createElement("TD");
                        td3.innerHTML = numberWithCommas(result[key]["agreeamt"]);
                        td3.style.padding = "3px";
                        td3.style.textAlign = "right";

                    var td4 = document.createElement("TD");
                        td4.innerHTML = result[key]["times"];
                        td4.style.padding = "3px";
                        td4.style.textAlign = "center";

                    var td5 = document.createElement("TD");
                        if (result[key]["receiptdate"]){
                            td5.innerHTML = result[key]["receiptdate"].substr(0,10);
                        } else {
                            td5.innerHTML = result[key]["receiptdate"];
                        }
                        td5.style.padding = "3px";
                        td5.style.textAlign = "center";

                    var td6 = document.createElement("TD");
                        td6.innerHTML = numberWithCommas(result[key]["receiptamt"]);
                        td6.style.padding = "3px";
                        td6.style.textAlign = "right";

                    var td7 = document.createElement("TD");
                        td7.innerHTML = result[key]["delaydays"];
                        td7.style.padding = "3px";
                        td7.style.textAlign = "center";

                    var td8 = document.createElement("TD");
                        td8.innerHTML = numberWithCommas(result[key]["delayamt"]);
                        td8.style.padding = "3px";
                        td8.style.textAlign = "right";

                    var td9 = document.createElement("TD");
                        td9.innerHTML = result[key]["discntdays"];
                        td9.style.padding = "3px";
                        td9.style.textAlign = "center";

                    var td10 = document.createElement("TD");
                        td10.innerHTML = numberWithCommas(result[key]["discntamt"]);
                        td10.style.padding = "3px";
                        td10.style.textAlign = "right";

                    var td11 = document.createElement("TD");
                        td11.innerHTML = numberWithCommas(result[key]["real_receiptamt"]);
                        td11.style.padding = "3px";
                        td11.style.textAlign = "right";

                    var tr = document.createElement("TR");
                        tr.appendChild(td1)
                        tr.appendChild(td2)
                        tr.appendChild(td3)
                        tr.appendChild(td4)
                        tr.appendChild(td5)
                        tr.appendChild(td6)
                        tr.appendChild(td7)
                        tr.appendChild(td8)
                        tr.appendChild(td9)
                        tr.appendChild(td10)
                        tr.appendChild(td11)
                    table.appendChild(tr)
                }

                setTable.appendChild(table)

                
                
                //document.getElementById('detail').appendChild(html);
              //  console.log(xhr.responseText);

                //document.querySelector(".result").innerHTML = xhr.responseText
            });
        }

    </script>


<form id="frm">
    <input type="hidden" id="a" name="out_buildno">
    <input type="hidden" id="b" name="out_houseno">
</form>

<div style=" border:1px solid #fcf1f5;; float:left; height: 50%;">
<table class="bluetop">
    <tr>
        <th>현장</th>
        <th>동</th>
        <th>호수</th>
    </tr>
    <%
    for(var i=0; i<result.length; i++)
    {
        var data = result[i];
    %>
    <tr onclick="rowclick(this)">
        <td><%=data.SHORTNAME%></td>
        <td><%=data.out_buildno%></td>
        <td><%=data.out_houseno%></td>
        <input type="hidden" value="<%=data.custcode%>"></input>
        <input type="hidden" value="<%=data.seq%>"></input>
    </tr>
    <%}%>
</table>
</div>
<div id = "setTable" style="float:left; border:1px solid #fcf1f5;; margin-left: 50px; height: 50%;"></div>
<footer style="text-align: center;">
<div style="place-items: center; margin-top: 600px; width: 100%; height: 20%;">
    <a href="http://angangenc.co.kr/" title="홈페이지로 이동">
        <img src="http://angangenc.co.kr/kr/assets/img/logo/svg/logo-en-color.svg" alt="로고" style="opacity: 0.5; filter: alpha(opacity=50); "width ="20%">
    </a>
</div>
</footer>
</body>
</html>
